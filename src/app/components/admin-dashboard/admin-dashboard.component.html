<style>
/* ===== VARIABLES Y ESTILOS BASE ===== */
.dashboard-container {
  max-width: 1280px;
  margin: 0 auto;
  padding: 1.5rem;
}

.cards-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1.5rem;
  margin-bottom: 2rem;
}

@media (min-width: 768px) {
  .cards-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (min-width: 1024px) {
  .cards-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

/* ===== COLOR UTILITIES ===== */
.bg-blue-500 { background-color: #3b82f6 !important; color: white !important; }
.bg-green-500 { background-color: #10b981 !important; color: white !important; }
.bg-yellow-500 { background-color: #f59e0b !important; color: white !important; }
.bg-gray-500 { background-color: #6b7280 !important; color: white !important; }
.bg-orange-500 { background-color: #f97316 !important; color: white !important; }

/* ===== COMPONENTES DEL DASHBOARD ===== */
.dashboard-card {
  background: white;
  padding: 1.5rem;
  border-radius: 0.75rem;
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
  transition: all 0.2s;
  cursor: pointer;
  text-align: left;
  border: none;
  min-height: 140px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.dashboard-card:hover {
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
  transform: translateY(-2px);
}

.admin-stats-card {
  background: linear-gradient(135deg, #3b82f6, #2563eb);
  color: white;
  min-height: 140px;
}

/* ===== FORMULARIOS Y CONTROLES ===== */
.search-input {
  flex: 1;
  min-width: 300px;
  padding: 0.75rem 1rem;
  border: 1px solid #d1d5db;
  border-radius: 0.5rem;
  font-size: 0.875rem;
  background: white;
}

.search-input:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
}

.filter-select {
  padding: 0.75rem 1rem;
  border: 1px solid #d1d5db;
  border-radius: 0.5rem;
  font-size: 0.875rem;
  background: white;
  min-width: 200px;
}

.filter-select:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
}

/* ===== CALENDARIO - ESTILOS PRINCIPALES ===== */
.calendar-header {
  background: linear-gradient(135deg, #3b82f6, #1d4ed8) !important;
  color: white !important;
  padding: 1rem 1.5rem !important;
  margin: -1.5rem -1.5rem 1rem -1.5rem !important;
}

.calendar-month {
  font-size: 1rem !important;
  font-weight: 600 !important;
  text-align: center !important;
  margin: 0 !important;
}

.calendar-close-btn {
  background: #ef4444 !important;
  color: white !important;
  width: 2rem !important;
  height: 2rem !important;
  border-radius: 50% !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  border: none !important;
  cursor: pointer !important;
  font-size: 1.25rem !important;
  transition: all 0.2s !important;
}

.calendar-close-btn:hover {
  background: #dc2626 !important;
  transform: scale(1.1) !important;
}

.month-nav-btn {
  width: 2rem !important;
  height: 2rem !important;
  border-radius: 50% !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  border: 1px solid #d1d5db !important;
  background: white !important;
  cursor: pointer !important;
  transition: all 0.2s !important;
  font-size: 1rem !important;
}

.month-nav-btn:hover {
  background: #f3f4f6 !important;
  border-color: #9ca3af !important;
}

.calendar-grid {
  display: grid !important;
  grid-template-columns: repeat(7, 1fr) !important;
  gap: 0.15rem !important;
  margin-bottom: 1rem !important;
}

.week-day {
  font-size: 0.7rem !important;
  font-weight: 600 !important;
  color: #4b5563 !important;
  text-align: center !important;
  padding: 0.4rem 0 !important;
  text-transform: uppercase !important;
  background: #f8fafc !important;
  border-radius: 0.25rem !important;
  margin: 0.1rem !important;
}

/* ===== DÍAS DEL CALENDARIO ===== */
.calendar-day {
  width: 2rem !important;
  height: 2rem !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  border-radius: 0.375rem !important;
  cursor: pointer !important;
  transition: all 0.2s !important;
  position: relative !important;
  font-size: 0.75rem !important;
  font-weight: 500 !important;
  margin: 0 auto !important;
}

.calendar-day:hover {
  background: #3b82f6 !important;
  color: white !important;
  transform: scale(1.05) !important;
}

.calendar-day.today {
  background: #ef4444 !important;
  color: white !important;
  font-weight: 600 !important;
  box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3) !important;
}

.calendar-day.selected {
  background: #10b981 !important;
  color: white !important;
  font-weight: 600 !important;
  box-shadow: 0 2px 4px rgba(16, 185, 129, 0.3) !important;
}

.calendar-day.other-month {
  color: #9ca3af !important;
  background: #f9fafb !important;
}

.calendar-day.other-month:hover {
  background: #e5e7eb !important;
  color: #6b7280 !important;
}

/* ===== PUNTOS DE EVENTOS EN CALENDARIO ===== */
.event-dot {
  position: absolute !important;
  bottom: 2px !important;
  left: 50% !important;
  transform: translateX(-50%) !important;
  width: 6px !important;
  height: 6px !important;
  border-radius: 50% !important;
  z-index: 10 !important;
  box-shadow: 0 0 0 2px white !important;
}

.event-dot-training {
  background: #10b981 !important;
}

.event-dot-tournament {
  background: #8b5cf6 !important;
}

.event-dot-mixed {
  background: linear-gradient(135deg, #10b981 50%, #8b5cf6 50%) !important;
}

/* Días con eventos */
.calendar-day.has-events {
  background: #f8fafc !important;
  font-weight: 600 !important;
  position: relative !important;
}

.calendar-day.has-events:hover {
  background: #3b82f6 !important;
  color: white !important;
}

.calendar-day.has-events.today {
  background: #ef4444 !important;
  color: white !important;
}

.calendar-day.has-events.selected {
  background: #10b981 !important;
  color: white !important;
}

/* ===== ITEMS DE EVENTOS ===== */
.event-item {
  padding: 0.75rem !important;
  border-radius: 0.5rem !important;
  margin-bottom: 0.5rem !important;
  border-left: 4px solid !important;
  transition: all 0.2s !important;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
  position: relative !important;
}

.event-item:hover {
  transform: translateX(2px) !important;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15) !important;
}

.event-training {
  background: #f0fdf4 !important;
  border-left-color: #10b981 !important;
  color: #065f46 !important;
}

.event-tournament {
  background: #f3e8ff !important;
  border-left-color: #8b5cf6 !important;
  color: #6b21a8 !important;
}

.event-meeting {
  background: #fffbeb !important;
  border-left-color: #f59e0b !important;
  color: #92400e !important;
}

.event-match {
  background: #fef2f2 !important;
  border-left-color: #ef4444 !important;
  color: #991b1b !important;
}

/* ===== BOTONES FLOTANTES ===== */
.floating-btn {
  width: 3rem !important;
  height: 3rem !important;
  border-radius: 50% !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  font-size: 1.125rem !important;
  z-index: 40 !important;
  border: none !important;
  cursor: pointer !important;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.05) !important;
  position: fixed !important;
  transition: all 0.3s ease !important;
}

.floating-btn:hover {
  transform: scale(1.1) !important;
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05) !important;
}

.calendar-btn {
  background: #3b82f6 !important;
  color: white !important;
  left: 1rem !important;
  top: 1rem !important;
}

.calendar-btn:hover {
  background: #2563eb !important;
}

.chat-btn {
  background: #10b981 !important;
  color: white !important;
  right: 1rem !important;
  bottom: 1rem !important;
}

.chat-btn:hover {
  background: #059669 !important;
}

/* ===== SIDEBARS ===== */
.sidebar {
  width: 24rem !important;
  height: 100vh !important;
  background: white !important;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25) !important;
  z-index: 50 !important;
  position: fixed !important;
  top: 0 !important;
  transition: transform 0.3s ease-in-out !important;
  overflow-y: auto !important;
}

.calendar-sidebar {
  left: 0 !important;
  transform: translateX(-100%) !important;
}

.calendar-sidebar.open {
  transform: translateX(0) !important;
}

.chat-sidebar {
  right: 0 !important;
  transform: translateX(100%) !important;
}

.chat-sidebar.open {
  transform: translateX(0) !important;
}

/* Ocultar botones flotantes cuando sidebar está abierto */
.calendar-sidebar.open ~ .floating-btn.calendar-btn,
.chat-sidebar.open ~ .floating-btn.chat-btn {
  display: none !important;
}

/* ===== ANIMACIONES ===== */
.animate-fade-in {
  animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
  from { 
    opacity: 0; 
    transform: translateY(10px); 
  }
  to { 
    opacity: 1; 
    transform: translateY(0); 
  }
}

.fade-in {
  animation: fadeIn 0.3s ease-in;
}

/* ===== BADGES DE ESTADO ===== */
.tournament-active {
  background: #dcfce7 !important;
  color: #166534 !important;
}

.tournament-scheduled {
  background: #fef9c3 !important;
  color: #854d0e !important;
}

.tournament-finished {
  background: #f3f4f6 !important;
  color: #374151 !important;
}

/* ===== RESPONSIVE ADJUSTMENTS ===== */
@media (max-width: 640px) {
  .dashboard-container {
    padding: 1rem;
  }
  
  .sidebar {
    width: 100% !important;
  }
  
  .search-input {
    min-width: 100%;
  }
  
  .filter-select {
    min-width: 100%;
  }
}
</style>

<!-- Dashboard Administrador -->
<div class="min-h-screen bg-gradient-to-br from-purple-900 via-purple-800 to-indigo-900">

  <!-- Navigation -->
  <nav class="bg-white shadow-lg">
    <div class="max-w-7xl mx-auto px-4">
      <div class="flex justify-between items-center py-4">
        <div class="flex items-center space-x-3">
          <div class="bg-purple-600 w-10 h-10 rounded-full flex items-center justify-center">
            <span class="text-white font-bold">⚙️</span>
          </div>
          <h1 class="text-xl font-bold text-gray-800">Panel de Administrador</h1>
        </div>
        <div class="flex items-center space-x-4">
          <span class="text-gray-700">Bienvenido, {{ currentUser?.firstName }}</span>
          <button (click)="logout()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-200">
            Salir
          </button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="dashboard-container">
    <!-- Quick Actions Grid -->
    <div class="cards-grid">
      <button (click)="showUsers()" class="dashboard-card">
        <div class="text-3xl mb-3">👥</div>
        <h3 class="text-lg font-semibold text-gray-800">Gestionar Usuarios</h3>
        <p class="text-gray-600">Gestión completa de usuarios</p>
      </button>

      <button (click)="showTournaments()" class="dashboard-card">
        <div class="text-3xl mb-3">🏆</div>
        <h3 class="text-lg font-semibold text-gray-800">Gestionar Torneos</h3>
        <p class="text-gray-600">{{ systemStats.activeTournaments }} torneos activos</p>
      </button>

      <button (click)="showReports()" class="dashboard-card">
        <div class="text-3xl mb-3">📈</div>
        <h3 class="text-lg font-semibold text-gray-800">Generar Reportes</h3>
        <p class="text-gray-600">Análisis y estadísticas</p>
      </button>
    </div>

    <!-- Dynamic Content Area -->
    <div class="bg-white rounded-xl shadow-lg p-6 min-h-[500px]">
      
      <!-- Welcome View -->
      <div *ngIf="currentView === 'welcome'" class="fade-in">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Panel de Administración</h2>
        
        <!-- Estadísticas Rápidas -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
          <div class="admin-stats-card p-4 rounded-lg text-white text-center">
            <div class="text-2xl font-bold">{{ systemStats.totalUsers }}</div>
            <div class="text-sm opacity-90">Usuarios Totales</div>
          </div>
          <div class="bg-green-500 p-4 rounded-lg text-white text-center">
            <div class="text-2xl font-bold">{{ systemStats.activeUsers }}</div>
            <div class="text-sm opacity-90">Usuarios Activos</div>
          </div>
          <div class="bg-blue-500 p-4 rounded-lg text-white text-center">
            <div class="text-2xl font-bold">{{ systemStats.totalTrainings }}</div>
            <div class="text-sm opacity-90">Entrenamientos</div>
          </div>
          <div class="bg-orange-500 p-4 rounded-lg text-white text-center">
            <div class="text-2xl font-bold">{{ systemStats.activeTournaments }}</div>
            <div class="text-sm opacity-90">Torneos Activos</div>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- Actividad Reciente -->
          <div class="bg-gray-50 rounded-lg p-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">📊 Actividad Reciente</h3>
            <div class="space-y-3">
              <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                <span class="text-sm">Entrenamientos programados</span>
                <span class="font-semibold text-blue-600">{{ systemStats.totalTrainings }}</span>
              </div>
            </div>
          </div>

          <!-- Acciones Rápidas -->
          <div class="bg-gray-50 rounded-lg p-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">🚀 Acciones Rápidas</h3>
            <div class="space-y-3">
              <button (click)="showUsers()" class="w-full text-left p-3 bg-white rounded-lg hover:bg-purple-50 transition duration-200">
                <span class="font-medium">➕ Agregar Nuevo Usuario</span>
                <p class="text-sm text-gray-600">Crear cuenta para jugador o entrenador</p>
              </button>
              <button (click)="showTournaments()" class="w-full text-left p-3 bg-white rounded-lg hover:bg-purple-50 transition duration-200">
                <span class="font-medium">🏆 Crear Nuevo Torneo</span>
                <p class="text-sm text-gray-600">Configurar competencia</p>
              </button>
              <button (click)="showReports()" class="w-full text-left p-3 bg-white rounded-lg hover:bg-purple-50 transition duration-200">
                <span class="font-medium">📈 Generar Reporte</span>
                <p class="text-sm text-gray-600">Estadísticas del sistema</p>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Users Management View -->
      <div *ngIf="currentView === 'users'" class="fade-in">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Gestión de Usuarios</h2>
          <button (click)="createUser()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition duration-200">
            + Agregar Usuario
          </button>
        </div>

        <!-- Formulario para nuevo usuario -->
        <div class="bg-gray-50 rounded-lg p-6 mb-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Crear Nuevo Usuario</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <input type="text" [(ngModel)]="newUser.firstName" placeholder="Nombre *" 
                   class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
            <input type="text" [(ngModel)]="newUser.lastName" placeholder="Apellido *" 
                   class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
            <input type="text" [(ngModel)]="newUser.username" placeholder="Usuario" 
                   class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
            <input type="email" [(ngModel)]="newUser.email" placeholder="Email *" 
                   class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
            <input type="text" [(ngModel)]="newUser.phone" placeholder="Teléfono (opcional)" 
                   class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
            <select [(ngModel)]="newUser.role" 
                    class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
              <option value="jugador">Jugador</option>
              <option value="entrenador">Entrenador</option>
              <option value="administrador">Administrador</option>
            </select>
          </div>
          <div class="mt-4">
            <input type="password" [(ngModel)]="newUser.password" placeholder="Contraseña *" 
                   class="px-3 py-2 border border-gray-300 rounded-lg w-full md:w-1/2 focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
          </div>
          <div class="mt-4">
            <button (click)="createUser()" 
                    [disabled]="loading"
                    class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition duration-200 disabled:opacity-50">
              {{ loading ? 'Creando...' : 'Crear Usuario' }}
            </button>
          </div>
        </div>

        <!-- Filtros y Búsqueda -->
        <div class="flex flex-col md:flex-row gap-4 mb-6">
          <input type="text" [(ngModel)]="userSearchTerm" placeholder="Buscar por nombre, email o usuario..." 
                 class="search-input">
          <select [(ngModel)]="userRoleFilter" class="filter-select">
            <option value="all">Todos los roles</option>
            <option value="administrador">Administradores</option>
            <option value="entrenador">Entrenadores</option>
            <option value="jugador">Jugadores</option>
          </select>
          <select [(ngModel)]="userStatusFilter" class="filter-select">
            <option value="all">Todos los estados</option>
            <option value="active">Solo activos</option>
            <option value="inactive">Solo inactivos</option>
          </select>
        </div>

        <!-- Tabla de Usuarios -->
        <div class="bg-white border rounded-lg overflow-hidden">
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Usuario</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Rol</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estado</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Acciones</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-200">
                <!-- Modal de edición -->
                <tr *ngIf="editingUser" class="bg-yellow-50">
                  <td colspan="5" class="px-6 py-4">
                    <div class="space-y-4">
                      <h4 class="font-semibold text-gray-800">Editando usuario: {{ editingUser.firstName }} {{ editingUser.lastName }}</h4>
                      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <input type="text" [(ngModel)]="editingUser.firstName" placeholder="Nombre" 
                               class="px-3 py-2 border border-gray-300 rounded-lg">
                        <input type="text" [(ngModel)]="editingUser.lastName" placeholder="Apellido" 
                               class="px-3 py-2 border border-gray-300 rounded-lg">
                        <input type="email" [(ngModel)]="editingUser.email" placeholder="Email" 
                               class="px-3 py-2 border border-gray-300 rounded-lg">
                        <select [(ngModel)]="editingUser.role" class="px-3 py-2 border border-gray-300 rounded-lg">
                          <option value="jugador">Jugador</option>
                          <option value="entrenador">Entrenador</option>
                          <option value="administrador">Administrador</option>
                        </select>
                      </div>
                      <div class="flex gap-2">
                        <button (click)="updateUser()" 
                                [disabled]="loading"
                                class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200 disabled:opacity-50">
                          {{ loading ? 'Guardando...' : 'Guardar Cambios' }}
                        </button>
                        <button (click)="cancelEdit()" 
                                class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition duration-200">
                          Cancelar
                        </button>
                      </div>
                    </div>
                  </td>
                </tr>

                <!-- Lista de usuarios -->
                <tr *ngFor="let user of filteredUsers" class="hover:bg-gray-50">
                  <td class="px-6 py-4">
                    <div class="flex items-center">
                      <div class="w-8 h-8 rounded-full bg-purple-500 flex items-center justify-center text-white text-sm font-semibold mr-3">
                        {{ user.firstName.charAt(0) }}{{ user.lastName.charAt(0) }}
                      </div>
                      <div>
                        <div class="font-medium text-gray-900">{{ user.firstName }} {{ user.lastName }}</div>
                        <div class="text-sm text-gray-500">@{{ user.username }}</div>
                      </div>
                    </div>
                  </td>
                  <td class="px-6 py-4 text-gray-600">{{ user.email }}</td>
                  <td class="px-6 py-4">
                    <span [class]="'px-2 py-1 rounded-full text-xs font-medium ' + getRoleBadgeClass(user.role)">
                      {{ user.role }}
                    </span>
                  </td>
                  <td class="px-6 py-4">
                    <span [class]="'px-2 py-1 rounded-full text-xs font-medium ' + getStatusBadgeClass(user.status)">
                      {{ user.status === 'active' ? 'Activo' : 'Inactivo' }}
                    </span>
                  </td>
                  <td class="px-6 py-4">
                    <div class="flex space-x-2">
                      <button (click)="editUser(user)" 
                              class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                        Editar
                      </button>
                      <button (click)="deleteUser(user.id)" 
                              class="text-red-600 hover:text-red-800 text-sm font-medium">
                        Eliminar
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div *ngIf="filteredUsers.length === 0 && !loading" class="text-center py-8 text-gray-500">
          No se encontraron usuarios
        </div>

        <div *ngIf="loading" class="text-center py-8">
          <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"></div>
          <p class="text-gray-600 mt-2">Cargando usuarios...</p>
        </div>
      </div>

           <!-- Tournaments Management View -->
      <div *ngIf="currentView === 'tournaments'" class="fade-in">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Gestión de Torneos</h2>
          <button (click)="createTournament()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition duration-200">
            + Crear Torneo
          </button>
        </div>

        <!-- Estadísticas de Torneos -->
        <div class="grid grid-cols-2 md:grid-cols-2 gap-4 mb-6">
          <div class="bg-blue-500 p-4 rounded-lg text-white text-center">
            <div class="text-2xl font-bold">{{ tournamentStats.totalTournaments }}</div>
            <div class="text-sm opacity-90">Total Torneos</div>
          </div>
          <div class="bg-green-500 p-4 rounded-lg text-white text-center">
            <div class="text-2xl font-bold">{{ tournamentStats.activeTournaments }}</div>
            <div class="text-sm opacity-90">Activos</div>
          </div>
        </div>

        <!-- Formulario para nuevo torneo -->
        <div class="bg-gray-50 rounded-lg p-6 mb-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Crear Nuevo Torneo</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Nombre del torneo *</label>
              <input type="text" [(ngModel)]="newTournament.name" placeholder="Ej: Torneo de Verano 2025" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Número de equipos</label>
              <input type="number" [(ngModel)]="newTournament.teamsCount" placeholder="Ej: 8" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Fecha de inicio *</label>
              <input type="datetime-local" [(ngModel)]="newTournament.startDate" 
                     [min]="getCurrentDateTime()"
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Fecha de fin (opcional)</label>
              <input type="datetime-local" [(ngModel)]="newTournament.endDate" 
                     [min]="newTournament.startDate || getCurrentDateTime()"
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
            </div>
            <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-1">Descripción (opcional)</label>
              <textarea [(ngModel)]="newTournament.description" placeholder="Describe el torneo, equipos participantes, formato, etc." 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" rows="3"></textarea>
            </div>
          </div>
          <div class="mt-4">
            <button (click)="createTournament()" 
                    [disabled]="loading"
                    class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition duration-200 disabled:opacity-50">
              {{ loading ? 'Creando...' : 'Crear Torneo' }}
            </button>
          </div>
        </div>

        <!-- Lista de Torneos -->
        <div class="bg-white border rounded-lg overflow-hidden">
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Torneo</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Fechas</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Equipos</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estado</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Acciones</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-200">
                <!-- Modal de edición -->
                <tr *ngIf="editingTournament" class="bg-yellow-50">
                  <td colspan="5" class="px-6 py-4">
                    <div class="space-y-4">
                      <h4 class="font-semibold text-gray-800">Editando torneo: {{ editingTournament.name }}</h4>
                      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" [(ngModel)]="editingTournament.name" placeholder="Nombre" 
                               class="px-3 py-2 border border-gray-300 rounded-lg">
                        <input type="number" [(ngModel)]="editingTournament.teamsCount" placeholder="Equipos" 
                               class="px-3 py-2 border border-gray-300 rounded-lg">
                        <input type="datetime-local" [(ngModel)]="editingTournament.startDate" 
                               class="px-3 py-2 border border-gray-300 rounded-lg">
                        <input type="datetime-local" [(ngModel)]="editingTournament.endDate" 
                               class="px-3 py-2 border border-gray-300 rounded-lg">
                        <textarea [(ngModel)]="editingTournament.description" placeholder="Descripción" 
                                  class="px-3 py-2 border border-gray-300 rounded-lg md:col-span-2" rows="2"></textarea>
                      </div>
                      <div class="flex gap-2">
                        <button (click)="updateTournament()" 
                                [disabled]="loading"
                                class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200 disabled:opacity-50">
                          {{ loading ? 'Guardando...' : 'Guardar Cambios' }}
                        </button>
                        <button (click)="cancelTournamentEdit()" 
                                class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition duration-200">
                          Cancelar
                        </button>
                      </div>
                    </div>
                  </td>
                </tr>

                <!-- Lista de torneos -->
                <tr *ngFor="let tournament of tournaments" class="hover:bg-gray-50">
                  <td class="px-6 py-4">
                    <div>
                      <div class="font-medium text-gray-900">{{ tournament.name }}</div>
                      <div *ngIf="tournament.description" class="text-sm text-gray-500">{{ tournament.description }}</div>
                    </div>
                  </td>
                  <td class="px-6 py-4 text-gray-600">
                    <div class="text-sm">{{ tournament.startDate | date:'dd/MM/yyyy' }}</div>
                    <div *ngIf="tournament.endDate" class="text-xs text-gray-500">al {{ tournament.endDate | date:'dd/MM/yyyy' }}</div>
                  </td>
                  <td class="px-6 py-4">
                    <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">
                      {{ tournament.teamsCount }} equipos
                    </span>
                  </td>
                  <td class="px-6 py-4">
                    <span [class]="getTournamentStatusBadgeClass(tournament.status)">
                      {{ getTournamentStatusText(tournament.status) }}
                    </span>
                  </td>
                  <td class="px-6 py-4">
                    <div class="flex space-x-2">
                      <button (click)="editTournament(tournament)" 
                              class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                        Editar
                      </button>
                      <button (click)="deleteTournament(tournament.id)" 
                              class="text-red-600 hover:text-red-800 text-sm font-medium">
                        Eliminar
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div *ngIf="tournaments.length === 0 && !loading" class="text-center py-8 text-gray-500">
          No se encontraron torneos
        </div>
      </div>

      <!-- Reports View -->
      <div *ngIf="currentView === 'reports'" class="fade-in">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Generar Reportes</h2>
          <div class="flex gap-3">
            <button 
              *ngIf="reportData"
              (click)="downloadPDF()" 
              class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-gray-800 transition duration-200 flex items-center gap-2">
              📥 Descargar PDF
            </button>
            <button 
              (click)="generateReports()" 
              [disabled]="generatingReport"
              class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition duration-200 disabled:opacity-50 flex items-center gap-2">
              {{ generatingReport ? '🔄 Generando...' : '📊 Generar Reportes' }}
            </button>
          </div>
        </div>

        <!-- Loading State -->
        <div *ngIf="generatingReport" class="text-center py-12">
          <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mb-4"></div>
          <p class="text-gray-600">Generando reportes con datos actuales...</p>
        </div>

        <!-- No Data State -->
        <div *ngIf="!reportData && !generatingReport" class="text-center py-12 bg-gray-50 rounded-lg">
          <div class="text-6xl mb-4">📊</div>
          <h3 class="text-xl font-semibold text-gray-700 mb-2">Reportes del Sistema</h3>
          <p class="text-gray-500 mb-6">Genera reportes con datos reales del sistema</p>
          <button 
            (click)="generateReports()" 
            class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition duration-200">
            🚀 Generar Mi Primer Reporte
          </button>
        </div>

        <!-- Report Data -->
        <div *ngIf="reportData && !generatingReport" class="space-y-6">
          <!-- Header Info -->
          <div class="bg-gradient-to-r from-purple-500 to-blue-600 text-white rounded-lg p-6">
            <div class="flex justify-between items-start">
              <div>
                <h3 class="text-xl font-bold mb-2">Reporte del Sistema</h3>
                <p class="opacity-90">Generado el {{ reportData.generatedAt }}</p>
              </div>
              <div class="text-right">
                <div class="text-2xl font-bold">{{ reportData.userStats.total }}</div>
                <div class="text-sm opacity-90">Usuarios Totales</div>
              </div>
            </div>
          </div>

          <!-- User Statistics -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white border rounded-lg p-6">
              <h4 class="text-lg font-semibold text-gray-800 mb-4">👥 Distribución de Usuarios</h4>
              <div class="space-y-3">
                <div *ngFor="let role of reportData.userStats.byRole" 
                     class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                  <span class="font-medium">{{ getRoleName(role.role) }}</span>
                  <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
                    {{ role._count.id }} usuarios
                  </span>
                </div>
                <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg border border-green-200">
                  <span class="font-medium text-green-800">Nuevos este mes</span>
                  <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                    +{{ reportData.userStats.newThisMonth }}
                  </span>
                </div>
              </div>
            </div>

            <!-- Training Statistics -->
            <div class="bg-white border rounded-lg p-6">
              <h4 class="text-lg font-semibold text-gray-800 mb-4">🏋️ Estadísticas de Entrenamientos</h4>
              <div class="space-y-3">
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                  <span class="font-medium">Total de entrenamientos</span>
                  <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium">
                    {{ reportData.trainingStats.total }}
                  </span>
                </div>
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                  <span class="font-medium">Entrenamientos activos</span>
                  <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                    {{ reportData.trainingStats.active }}
                  </span>
                </div>
                <div *ngFor="let type of reportData.trainingStats.byType" 
                     class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                  <span class="font-medium">{{ getTrainingTypeName(type.type) }}</span>
                  <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                    {{ type._count.id }}
                  </span>
                </div>
              </div>
            </div>
          </div>

          <!-- System Statistics -->
          <div class="bg-white border rounded-lg p-6">
            <h4 class="text-lg font-semibold text-gray-800 mb-4">⚙️ Estadísticas del Sistema</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="text-center p-4 bg-blue-50 rounded-lg">
                <div class="text-2xl font-bold text-blue-600">{{ reportData.systemStats.storageUsed }}</div>
                <div class="text-sm text-blue-800 mt-1">Almacenamiento Usado</div>
              </div>
              <div class="text-center p-4 bg-purple-50 rounded-lg">
                <div class="text-2xl font-bold text-purple-600">{{ reportData.tournamentStats.total }}</div>
                <div class="text-sm text-purple-800 mt-1">Torneos Totales</div>
              </div>
            </div>
          </div>

          <!-- Monthly Training Activity -->
          <div class="bg-white border rounded-lg p-6">
            <h4 class="text-lg font-semibold text-gray-800 mb-4">📈 Actividad Mensual de Entrenamientos</h4>
            <div class="space-y-2">
              <div *ngFor="let month of getMonthlyTrainingData()" 
                   class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <span class="font-medium capitalize">{{ month.month }}</span>
                <div class="flex items-center gap-4">
                  <div class="w-32 bg-gray-200 rounded-full h-2">
                    <div class="bg-green-600 h-2 rounded-full" [style.width.%]="month.percentage"></div>
                  </div>
                  <span class="text-sm font-medium text-gray-700 w-12 text-right">
                    {{ month.count }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  <!-- Floating Action Buttons -->
  <button (click)="toggleCalendar()" class="floating-btn calendar-btn">
    📅
  </button>

  <button (click)="toggleChat()" class="floating-btn chat-btn">
    💬
  </button>
</div>

<!-- Calendar Sidebar - ACTUALIZADO -->
<div [class]="'sidebar calendar-sidebar ' + (calendarVisible ? 'open' : '')">
  <div class="p-0">
    <div class="calendar-header pt-8 pb-2"> 
      <div class="flex justify-between items-center mb-3">
        <div class="flex-1 text-center">
          <h2 class="text-lg font-bold">📅 Calendario</h2>
        </div>
        <button (click)="toggleCalendar()" class="calendar-close-btn bg-red-500 hover:bg-red-600">
          ×
        </button>
      </div>
      <div class="flex justify-between items-center">
        <button (click)="previousMonth()" class="month-nav-btn text-black bg-white bg-opacity-20 hover:bg-opacity-30">
          ‹
        </button>
        <h3 class="calendar-month">{{ currentMonth }}</h3>
        <button (click)="nextMonth()" class="month-nav-btn text-black bg-white bg-opacity-20 hover:bg-opacity-30">
          ›
        </button>
      </div>
    </div>

    <div class="p-4">
      <!-- Días de la semana -->
      <div class="calendar-grid mb-2">
        <div class="week-day">D</div>
        <div class="week-day">L</div>
        <div class="week-day">M</div>
        <div class="week-day">M</div>
        <div class="week-day">J</div>
        <div class="week-day">V</div>
        <div class="week-day">S</div>
      </div>

      <!-- Días del calendario con eventos -->
      <div class="calendar-grid">
        <div *ngFor="let day of calendarDays" 
             [class]="getDayClass(day)"
             (click)="selectDate(day)"
             class="calendar-day">
          {{ day.date.getDate() }}
          <!-- 🆕 PUNTOS DE EVENTOS CORREGIDOS -->
          <div *ngIf="hasEvent(day.date)" 
               [class]="'event-dot ' + getEventDotClass(day.date)"></div>
        </div>
      </div>

      <!-- Eventos del día seleccionado -->
      <div class="mt-6 border-t pt-4">
        <h4 class="font-semibold text-gray-800 mb-3 text-sm">
          {{ selectedDate ? (selectedDate | date:'dd/MM/yyyy') : 'Hoy' }}
        </h4>
        <div class="space-y-2 max-h-60 overflow-y-auto">
          <!-- 🆕 EVENTOS CON CLASES DINÁMICAS -->
          <div *ngFor="let event of getDayEvents()" 
               [class]="getEventItemClass(event)">
            <div class="font-medium text-sm">{{ event.title }}</div>
            <div class="text-xs opacity-75 mt-1">{{ event.time }}</div>
            <div *ngIf="event.description" class="text-xs mt-1 text-opacity-90">
              {{ event.description }}
            </div>
            <div *ngIf="event.eventType === 'training' && event.coachName" class="text-xs mt-1">
    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded">
      👤 {{ event.coachName }}
    </span>
  </div>
            <!-- 🆕 BADGE DE TIPO DE EVENTO -->
            <div class="text-xs mt-1">
              <span [class]="event.eventType === 'tournament' ? 
                            'bg-purple-100 text-purple-800 px-2 py-1 rounded' : 
                            'bg-green-100 text-green-800 px-2 py-1 rounded'">
                {{ event.eventType === 'tournament' ? '🏆 Torneo' : '🏋️ Entrenamiento' }}
              </span>
            </div>
            
          </div>
          <div *ngIf="getDayEvents().length === 0" class="text-gray-500 text-sm text-center py-4">
            No hay eventos para este día
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Chat Sidebar -->
<div [class]="'sidebar chat-sidebar ' + (chatVisible ? 'open' : '')">
  <div class="p-4 border-b bg-green-600 text-white">
    <div class="flex justify-between items-center">
      <div class="flex-1 text-center"> <!-- Contenedor para centrar -->
        <h2 class="text-lg font-bold">💬 Chat General</h2>
      </div>
      <button (click)="toggleChat()" class="calendar-close-btn bg-red-500 hover:bg-red-600">
        ×
      </button>
    </div>
  </div>
  
  <!-- Área de mensajes -->
  <div class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50">
    <!-- Mensaje cuando no hay mensajes -->
    <div *ngIf="chatMessages.length === 0" class="text-center text-gray-500 py-8">
      <div class="text-4xl mb-2">💬</div>
      <p class="font-medium">No hay mensajes aún</p>
      <p class="text-sm mt-1">Sé el primero en enviar un mensaje</p>
    </div>

    <!-- Lista de mensajes -->
    <div *ngFor="let message of chatMessages" 
         class="flex"
         [class.justify-end]="isOwnMessage(message)" 
         [class.justify-start]="!isOwnMessage(message)">
      
      <!-- Mensaje de OTROS usuarios -->
      <div *ngIf="!isOwnMessage(message)" class="flex items-start space-x-3 max-w-xs">
        <!-- Avatar -->
        <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm font-semibold flex-shrink-0">
          {{ getAvatarInitials(message.sender) }}
        </div>
        <!-- Contenido del mensaje -->
        <div class="bg-white border border-gray-300 rounded-2xl p-4 shadow-sm">
          <!-- Información del remitente -->
          <div class="flex items-center space-x-2 mb-2">
            <span class="font-semibold text-sm text-gray-900">
              {{ message.sender.firstName }} {{ message.sender.lastName }}
            </span>
            <span class="text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded-full capitalize font-medium">
              {{ message.sender.role.toLowerCase() }}
            </span>
          </div>
          <!-- Texto del mensaje -->
          <div class="text-sm text-gray-800 break-words leading-relaxed">{{ message.content }}</div>
          <!-- Hora -->
          <div class="text-xs text-gray-500 mt-2">{{ message.createdAt | date:'HH:mm' }}</div>
        </div>
      </div>
      
      <!-- Mensaje PROPIO (Admin) -->
      <div *ngIf="isOwnMessage(message)" class="flex flex-col items-end max-w-xs">
        <!-- Información del remitente (tú) -->
        <div class="flex items-center space-x-2 mb-1 px-2">
          <span class="text-xs text-gray-600 font-medium">Tú</span>
          <span class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full capitalize font-medium">
            {{ currentUser?.role?.toLowerCase() }}
          </span>
        </div>
        <!-- Contenido del mensaje -->
        <div class="bg-green-600 text-white rounded-2xl p-4 shadow-sm">
          <!-- Texto del mensaje -->
          <div class="text-sm break-words leading-relaxed">{{ message.content }}</div>
          <!-- Hora y estado -->
          <div class="text-xs text-green-200 mt-2 flex justify-between items-center">
            <span>{{ message.createdAt | date:'HH:mm' }}</span>
            <span class="text-xs ml-2">✓✓</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Área de escritura -->
  <div class="p-4 border-t bg-white border-gray-200">
    <div class="flex flex-col space-y-3">
      <!-- Input de texto -->
      <div class="relative">
        <input 
          type="text" 
          [(ngModel)]="newMessage"
          (keydown.enter)="sendMessage()"
          placeholder="Escribe tu mensaje aquí..." 
          class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none transition duration-200 text-gray-900 bg-white text-base placeholder-gray-500">
        
        <!-- Indicador de texto visible -->
        <div *ngIf="newMessage" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-xs text-gray-500 bg-white px-1">
          {{ newMessage.length }}/500
        </div>
      </div>
      
      <!-- Botón enviar -->
      <button 
        (click)="sendMessage()" 
        [disabled]="!newMessage.trim()"
        class="w-full bg-green-600 text-white py-3 rounded-xl hover:bg-green-700 transition duration-200 disabled:bg-gray-400 disabled:cursor-not-allowed font-semibold text-base">
        Enviar Mensaje
      </button>
    </div>
    
    <p class="text-xs text-gray-500 mt-3 text-center">
      💡 Presiona Enter para enviar rápidamente
    </p>
  </div>
</div>
